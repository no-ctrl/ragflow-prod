# ============================================================================
# RAGFlow Production Environment - RunPod RTX 4090/5090 Optimization
# ============================================================================
# Focused optimization for Single GPU High-VRAM configurations
# Platform: AMD64 Linux
# GPU Driver: NVIDIA 535+
# ============================================================================

# ============================================================================
# Docker Compose Settings
# ============================================================================
DOC_ENGINE=elasticsearch
DEVICE=gpu
COMPOSE_PROFILES=${DOC_ENGINE},${DEVICE}
WORKSPACE_BASE=/workspace

# ============================================================================
# RAGFlow Image
# ============================================================================
RAGFLOW_IMAGE=infiniflow/ragflow:v0.23.1

# ============================================================================
# Security - CRITICAL: REPLACE THESE
# ============================================================================
ELASTIC_PASSWORD=REPLACE_WITH_STRONG_PASSWORD
MYSQL_PASSWORD=REPLACE_WITH_STRONG_PASSWORD
MINIO_PASSWORD=REPLACE_WITH_STRONG_PASSWORD
REDIS_PASSWORD=REPLACE_WITH_STRONG_PASSWORD
HF_TOKEN=

# ============================================================================
# GPU Inference - vLLM Optimization (RTX 4090 / 5090)
# ============================================================================

# --- Select Optimization Profile by Uncommenting ---

# -----------------------------------------------------------
# PROFILE A: STANDARD (RTX 3090 / 4090 / 5090) - Safe & Stable
# -----------------------------------------------------------
# Recommended for first run and stability.
# Model: Llama-3.1-8B-Instruct (High Quality, Fast)
# VRAM Usage: ~16GB + KV Cache
# VLLM_MODEL=meta-llama/Llama-3.1-8B-Instruct
# VLLM_GPU_MEMORY_UTIL=0.90
# VLLM_MAX_MODEL_LEN=8192
# VLLM_MAX_NUM_SEQS=256

# -----------------------------------------------------------
# PROFILE B: PERFORMANCE (RTX 4090 24GB) - Max Throughput
# -----------------------------------------------------------
# Maximizes 4090 capabilities.
# VLLM_MODEL=meta-llama/Llama-3.1-8B-Instruct
# VLLM_GPU_MEMORY_UTIL=0.95        # Aggressive memory usage
# VLLM_MAX_MODEL_LEN=16384         # Extended context window
# VLLM_MAX_NUM_BATCHED_TOKENS=16384
# VLLM_MAX_NUM_SEQS=512            # Higher concurrency

# -----------------------------------------------------------
# PROFILE C: ULTIMATE (RTX 5090 32GB+) - Huge Context
# -----------------------------------------------------------
# Utilizing massive 32GB+ VRAM buffer.
# VLLM_MODEL=meta-llama/Llama-3.1-8B-Instruct
# VLLM_GPU_MEMORY_UTIL=0.95
# VLLM_MAX_MODEL_LEN=32768         # Massive context window
# VLLM_MAX_NUM_BATCHED_TOKENS=32768
# VLLM_MAX_NUM_SEQS=1024

# -----------------------------------------------------------
# PROFILE D: INTELLIGENCE (RTX 5090 32GB+) - 70B Quantized
# -----------------------------------------------------------
# Running massive 70B model on single card via quantization.
# Requires AWQ or GPTQ model variant.
# VLLM_MODEL=casperhansen/llama-3-70b-instruct-awq
# VLLM_GPU_MEMORY_UTIL=0.98
# VLLM_MAX_MODEL_LEN=4096          # Reduced context for model space
# VLLM_MAX_NUM_SEQS=32             # Lower concurrency

# --- Active Configuration (Default: Profile A/B Hybrid) ---
VLLM_MODEL=meta-llama/Llama-3.1-8B-Instruct
VLLM_GPU_MEMORY_UTIL=0.92
VLLM_MAX_MODEL_LEN=8192
VLLM_MAX_BATCHED_TOKENS=8192
VLLM_MAX_NUM_SEQS=256
VLLM_PORT=8000

# Tensor parallelism (Keep at 1 for Single GPU)
VLLM_TENSOR_PARALLEL_SIZE=1

# ============================================================================
# Service Memory Limits (System RAM)
# ============================================================================
# RunPod usually provides 64GB+ RAM. These are safe defaults.
ES_JAVA_OPTS=-Xms4g -Xmx4g     # Elasticsearch Heap
MEM_LIMIT=8g                   # Elasticsearch Container Limit
MYSQL_MAX_PACKET=1073741824

# ============================================================================
# Component Hosts & Ports
# ============================================================================
STACK_VERSION=8.11.3
ES_HOST=elasticsearch
ES_PORT=9200
MYSQL_HOST=mysql
MYSQL_PORT=3306
MYSQL_DBNAME=rag_flow
MINIO_HOST=minio
MINIO_PORT=9000
MINIO_CONSOLE_PORT=9001
MINIO_USER=ragflow
REDIS_HOST=redis
REDIS_PORT=6379
SVR_WEB_HTTP_PORT=80
SVR_WEB_HTTPS_PORT=443
SVR_HTTP_PORT=9380
ADMIN_SVR_HTTP_PORT=9381
SVR_MCP_PORT=9382

# ============================================================================
# RAGFlow App Settings
# ============================================================================
REGISTER_ENABLED=1
DOC_BULK_SIZE=4
EMBEDDING_BATCH_SIZE=16
MAX_CONTENT_LENGTH=1073741824
TZ=UTC

# ============================================================================
# Optional Components (Disabled by default to save resources)
# ============================================================================
USE_DOCLING=false
# TEI_IMAGE_GPU=infiniflow/text-embeddings-inference:1.8
# TEI_MODEL=Qwen/Qwen3-Embedding-0.6B
# TEI_HOST=tei
# TEI_PORT=6380
